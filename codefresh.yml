version: '1.0'
steps:
  unit_test_step:
    title: "Executing unit tests..."
    image: node:10.15.3
    environment:
      - COVERALLS_SERVICE_NAME=codefresh-io
      - COVERALLS_REPO_TOKEN=${{COVERALLS_TOKEN}}
    working_directory: ${{main_clone}}
    commands:
      - yarn install --frozen-lockfile
      - yarn lint
      - yarn test

  deploy_to_npm:
     title: Publishing To Npm
     image: codefresh/npm-publish:master
     commands:
       - NPM_TOKEN=${{NPM_TOKEN}} npm run publish
     when:
       branch:
         only: [ master ]
